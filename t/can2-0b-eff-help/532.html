<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>can2.0B EFF help - Carloop Community</title>
    <meta name="description" content="has anyone came across can2.0b eff frames. trying to use canutils to dump eff frames. 
ive been into mopar stuff for a bit and this is the first time ive come across this, its on a 2013 dodge dart. 
ive been able to snif&amp;hellip;">
    <meta name="generator" content="Discourse 3.3.0.beta1-dev - https://github.com/discourse/discourse version e84d462e2804bde1e49fae2c55eecd329dc73dc0">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/5d0dc9f48a4fa5171a3a95c8befa000d9f0fe88b_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/f03d9faa7e5bd5b8a589b4ee5784e6678991578a_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="532.html">

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Carloop Community Search">

    <link href="../../stylesheets/color_definitions_base__1_c9899b2a42d6bd619c29b433a9ef7a3953a01da1.css?__ws=community.carloop.io" media="all" rel="stylesheet" class="light-scheme">

  <link href="../../stylesheets/desktop_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="desktop">



  <link href="../../stylesheets/chat_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="chat">
  <link href="../../stylesheets/checklist_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="checklist">
  <link href="../../stylesheets/discourse-details_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="discourse-details">
  <link href="../../stylesheets/discourse-lazy-videos_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="discourse-lazy-videos">
  <link href="../../stylesheets/discourse-local-dates_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="discourse-local-dates">
  <link href="../../stylesheets/discourse-narrative-bot_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="discourse-narrative-bot">
  <link href="../../stylesheets/discourse-presence_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="discourse-presence">
  <link href="../../stylesheets/docker_manager_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="docker_manager">
  <link href="../../stylesheets/footnote_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="footnote">
  <link href="../../stylesheets/poll_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="poll">
  <link href="../../stylesheets/spoiler-alert_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="spoiler-alert">
  <link href="../../stylesheets/chat_desktop_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="chat_desktop">
  <link href="../../stylesheets/poll_desktop_7659a6af5bea9aaa0d00bcc5111c495874284faf.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="poll_desktop">

  <link href="../../stylesheets/desktop_theme_1_68ec8432d72346d143d3760e6bc02ea5b1bbe8ac.css?__ws=community.carloop.io" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="1" data-theme-name="with top headers">

    
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-75724305-1" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

  <link rel="preload" href="../../assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.js" as="script" data-discourse-entrypoint="google-universal-analytics-v3" nonce="cZLd6ODiErnepPwLTIt1CVn1W">
<script defer="" src="../../assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.js" data-discourse-entrypoint="google-universal-analytics-v3" nonce="cZLd6ODiErnepPwLTIt1CVn1W"></script>


        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;can2.0B EFF help&#39;" href="532.rss">
    <meta property="og:site_name" content="Carloop Community">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/uploads/default/original/1X/f03d9faa7e5bd5b8a589b4ee5784e6678991578a.png">
<meta property="og:image" content="/uploads/default/original/1X/f03d9faa7e5bd5b8a589b4ee5784e6678991578a.png">
<meta property="og:url" content="/t/can2-0b-eff-help/532">
<meta name="twitter:url" content="/t/can2-0b-eff-help/532">
<meta property="og:title" content="can2.0B EFF help">
<meta name="twitter:title" content="can2.0B EFF help">
<meta property="og:description" content="has anyone came across can2.0b eff frames. trying to use canutils to dump eff frames.  ive been into mopar stuff for a bit and this is the first time ive come across this, its on a 2013 dodge dart.  ive been able to sniff the ECU on the bench of my 14 charger, and various other dodge models but this one is the first ive seen with Extended frame format.  ive tested with an arduino and mpc2515 library and have been able to receive the extended frames. im trying my hand at wrting a skectch for the ...">
<meta name="twitter:description" content="has anyone came across can2.0b eff frames. trying to use canutils to dump eff frames.  ive been into mopar stuff for a bit and this is the first time ive come across this, its on a 2013 dodge dart.  ive been able to sniff the ECU on the bench of my 14 charger, and various other dodge models but this one is the first ive seen with Extended frame format.  ive tested with an arduino and mpc2515 library and have been able to receive the extended frames. im trying my hand at wrting a skectch for the ...">
<meta property="article:published_time" content="2018-02-09T16:39:04+00:00">
<meta property="og:ignore_canonical" content="true">


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <a href="https://www.carloop.io" class="dow-menu" id="home"><span id="home-text">Home</span>
  <i class="fa fa-home" aria-hidden="true"></i></a>  
  <a href="https://carloop.readme.io/" class="dow-menu" id="docs">Documentation</a> 
</span>
</div>
    <header>
  <a href="../../index.htm">
    Carloop Community
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="532.html">can2.0B EFF help</a>
    </h1>


  </div>

  

    <div itemscope="" itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='can2.0B EFF help'>
      <link itemprop='url' href='532.html'>
      <meta itemprop='datePublished' content='2018-02-09T16:39:04Z'>
        <meta itemprop='articleSection' content='General Car Talk'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope="" itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='Carloop Community'>
          <div itemprop='logo' itemscope="" itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='/uploads/default/original/1X/1c11e9182b98c202a382d6f5862b4cc22c18a478.png'>
          </div>
      </div>


          <div id='post_1' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <a itemprop="url" href='../../u/dubb45.html'><span itemprop='name'>dubb45</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="532.html">


              <span class="crawler-post-infos">
                  <time datetime='2018-02-09T16:39:04Z' class='post-time'>
                    February 9, 2018,  4:39pm
                  </time>
                  <meta itemprop='dateModified' content='2018-02-09T16:39:04Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>has anyone came across can2.0b eff frames. trying to use canutils to dump eff frames.<br>
ive been into mopar stuff for a bit and this is the first time ive come across this, its on a 2013 dodge dart.<br>
ive been able to sniff the ECU on the bench of my 14 charger, and various other dodge models but this one is the first ive seen with Extended frame format.<br>
ive tested with an arduino and mpc2515 library and have been able to receive the extended frames. im trying my hand at wrting a skectch for the carloop but im not getting any data or maybe am not coding it right lol iv’e seen a sample on here and just want to be able to use canutils first to determine what id’s i need to look at. any help much appreciated. the crazy part is i can connect a cheap elm327 and request vin and it works. but if i connect the carloop (socketcan sketch) i dont see any data flowing by which leads me to belive i need to setup EFF with carloop receive filter.</p>
<pre><code class="lang-auto">#include "OBDMessage.h"

#include &lt;carloop.h&gt;
#include &lt;application.h&gt;
 
SYSTEM_THREAD(ENABLED);
Carloop&lt;CarloopRevision2&gt; carloop;

void setup() {
  CANChannel can(CAN_D1_D2);
  //can.addFilter(0, 0, CAN_FILTER_EXTENDED);
  Serial.begin(115200);
  can.begin(500000 , CAN_FILTER_EXTENDED);

}

void loop() {
tester();
CANMessage message;
if (carloop.can().receive(message)) {
 Serial.println("ID;");
 Serial.print(message.id);
 Serial.println("message data: ");
Serial.print(message.data[0]);
Serial.print(message.data[1]);
Serial.print(message.data[2]);
Serial.print(message.data[3]);
Serial.print(message.data[4]);
Serial.print(message.data[5]);
Serial.print(message.data[6]);
Serial.print(message.data[7]);
}

}

void tester() {

CANMessage message;
  OBDMessage obd;
  unsigned long start = millis();
  unsigned long timeout = 200; // ms
  while(millis() - start &lt; timeout) {
    if (carloop.can().receive(message)) {
if (message.id &gt;= 0x0814F001 ){
       // Serial.println("Got reply from ECU");

        // Add the data to our OBD message
        bool needsFlowControl = obd.addMessageData(message);

        if (needsFlowControl) {
          // Sending flow control
          CANMessage flowControl = obd.flowControlMessage();
          carloop.can().transmit(flowControl);
         // Serial.println("Sent flow control");
        }

        // Use the data when the message is complete
        if (obd.complete()) {
          String vin = "";
          // VIN is 17 character and can be left-padded with zeros
          for (int i = obd.size() - 200; i &lt; obd.size(); i++) {
            vin += String((char)obd.data()[i]);
          }
          Serial.println(vin);
          
           
          if (Particle.connected()) {
            Particle.publish("BCC", vin, PRIVATE);
          }

          obd.clear();
          //Serial.println("Done");
          return;
        }
      }
    }
  }

  Serial.println("NO DATA RECEVIED!!!");
  if (Particle.connected()) {
    Particle.publish("NO DATA RECEVIED!!!", PRIVATE);
  }
}</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction">
              <meta itemprop="userInteractionCount" content="0">
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction">
                <meta itemprop="userInteractionCount" content="0">
              </div>

          </div>
          <div id='post_2' itemprop='comment' itemscope="" itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <a itemprop="url" href='../../u/cyclin_al1.html'><span itemprop='name'>cyclin_al1</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-02-13T18:41:46Z' class='post-time'>
                    February 13, 2018,  6:41pm
                  </time>
                  <meta itemprop='dateModified' content='2018-02-13T18:41:46Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="../../u/dubb45.html">@dubb45</a>,  Can you link or share that arduino code that does work?  Maybe comparing the code may provide some clues.</p>
<p>I have not tried anything with EFF yet.</p>
<p>Another possibility, which I do not think is likely, is that the system firmware of the Photon/Electron/RedbearDuo would need to be updated to support EFF…</p>
            </div>

            <div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction">
              <meta itemprop="userInteractionCount" content="0">
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction">
                <meta itemprop="userInteractionCount" content="0">
              </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope="" itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <a itemprop="url" href='../../u/dubb45.html'><span itemprop='name'>dubb45</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-02-13T19:01:11Z' class='post-time'>
                    February 13, 2018,  7:01pm
                  </time>
                  <meta itemprop='dateModified' content='2018-02-13T23:57:17Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>yes heres the arduino code sample from the examples. i didn’t touch anything and its pulling data as is.</p>
<pre><code class="lang-auto">// CAN Receive Example
//

#include &lt;mcp_can.h&gt;
#include &lt;SPI.h&gt;

long unsigned int rxId;
unsigned char len = 0;
unsigned char rxBuf[8];
char msgString[128];                        // Array to store serial string

#define CAN0_INT 2                              // Set INT to pin 2
MCP_CAN CAN0(10);                               // Set CS to pin 10


void setup()
{
  Serial.begin(115200);
  
  // Initialize MCP2515 running at 16MHz with a baudrate of 500kb/s and the masks and filters disabled.
  if(CAN0.begin(MCP_ANY, CAN_500KBPS, MCP_16MHZ) == CAN_OK)
    Serial.println("MCP2515 Initialized Successfully!");
  else
    Serial.println("Error Initializing MCP2515...");
  
  CAN0.setMode(MCP_NORMAL);                     // Set operation mode to normal so the MCP2515 sends acks to received data.

  pinMode(CAN0_INT, INPUT);                            // Configuring pin for /INT input
  
  Serial.println("MCP2515 Library Receive Example...");
}

void loop()
{
  if(!digitalRead(CAN0_INT))                         // If CAN0_INT pin is low, read receive buffer
  {
    CAN0.readMsgBuf(&amp;rxId, &amp;len, rxBuf);      // Read data: len = data length, buf = data byte(s)
    
    if((rxId &amp; 0x80000000) == 0x80000000)     // Determine if ID is standard (11 bits) or extended (29 bits)
      sprintf(msgString, "Extended ID: 0x%.8lX  DLC: %1d  Data:", (rxId &amp; 0x1FFFFFFF), len);
    else
      sprintf(msgString, "Standard ID: 0x%.3lX       DLC: %1d  Data:", rxId, len);
  
    Serial.print(msgString);
  
    if((rxId &amp; 0x40000000) == 0x40000000){    // Determine if message is a remote request frame.
      sprintf(msgString, " REMOTE REQUEST FRAME");
      Serial.print(msgString);
    } else {
      for(byte i = 0; i&lt;len; i++){
        sprintf(msgString, " 0x%.2X", rxBuf[i]);
        Serial.print(msgString);
      }
    }
        
    Serial.println();
  }
}

/*********************************************************************************************************
  END FILE
*********************************************************************************************************/</code></pre>
<p>and that would explain why i cant see any data and my autel maxisys can see it fine. i know its ISO 15765-4 CAN (29 bit ID, 500 kbit/s) i can even use a cheap bluetooth elm327 to comminicate and pull info.</p>
<p>i guess i passed this up on the particle docs</p>
<pre><code class="lang-auto">addFilter()

Filter which messages will be added to the receive queue.
// SYNTAX
can.addFilter(id, mask);
can.addFilter(id, mask, type);By default all messages are received. When filters are added, only messages matching the filters will be received. Others will be discarded.Parameters:
id: the id pattern to match
mask: the mask pattern to match
type (optional): CAN_FILTER_STANDARD (default) or CAN_FILTER_EXTENDED
Returns: boolean true if the filter was added, false if there are too many filters (14 filters max).</code></pre>
<p>im going to try and see if anything comes up using the “extended” filter.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction">
              <meta itemprop="userInteractionCount" content="0">
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction">
                <meta itemprop="userInteractionCount" content="0">
              </div>

          </div>
    </div>


  




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope="" itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.htm' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope="" itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope="" itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
        <li itemscope="" itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope="" itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
